# 爻レベル分岐ロジック設計書

## 概要

易経の本来のロジックを活用し、「同じ卦でも、どの爻（段階）にいるかで処方箋が異なる」という予測フレームワークを構築する。

---

## 1. 爻の基本概念

### 1.1 六爻の位置と意味

```
上爻（第6爻）: 極み・終わり・やりすぎ・隠居
五爻（第5爻）: 頂点・君主・最適なタイミング
四爻（第4爻）: 接近・準備完了・慎重さが必要
三爻（第3爻）: 分岐点・危険・内と外の境界
二爻（第2爻）: 中庸・安定・基盤形成
初爻（第1爻）: 始まり・潜伏・まだ早い
```

### 1.2 位置の陰陽（正位・不正位）

- **正位**: 陽爻が奇数位置（1,3,5）、陰爻が偶数位置（2,4,6）にある
- **不正位**: その逆

正位 = 適切な行動 → 良い結果
不正位 = 不適切な行動 → 注意が必要

### 1.3 応爻の関係

```
上爻 ⟷ 三爻（外卦の上 ⟷ 内卦の上）
五爻 ⟷ 二爻（外卦の中 ⟷ 内卦の中）
四爻 ⟷ 初爻（外卦の下 ⟷ 内卦の下）
```

応爻が「陰陽異なる」場合 = 協力関係が成立
応爻が「陰陽同じ」場合 = 協力が得られにくい

---

## 2. 爻位による状態診断

### 2.1 ライフサイクルとしての6段階

| 爻位 | ライフサイクル | 企業フェーズ | 個人キャリア |
|-----|--------------|------------|------------|
| 初爻 | 発芽期 | スタートアップ・構想段階 | 新人・見習い |
| 二爻 | 成長期 | 成長軌道・基盤確立 | 中堅・実務者 |
| 三爻 | 成熟期入口 | 転換点・岐路 | 管理職候補 |
| 四爻 | 成熟期 | 拡大・M&A検討期 | 管理職・専門家 |
| 五爻 | 全盛期 | 業界リーダー | 経営層・第一人者 |
| 上爻 | 衰退/転換期 | 成熟産業・次の一手 | 引退・次世代育成 |

### 2.2 診断ルール

各ケースに対して「before_yao_position」を判定する基準：

```python
def diagnose_yao_position(case):
    """
    状態から爻位を診断
    """
    # 市場シェア/規模による判定
    if market_position == "startup" or years_in_business < 3:
        return 1  # 初爻
    elif growing_steadily and not_yet_leader:
        return 2  # 二爻
    elif at_crossroads or facing_disruption:
        return 3  # 三爻
    elif expanding_or_diversifying:
        return 4  # 四爻
    elif industry_leader or peak_performance:
        return 5  # 五爻
    elif mature_or_declining or post_peak:
        return 6  # 上爻
```

---

## 3. 爻変による遷移ロジック

### 3.1 基本原理

**爻が変わると、卦が変わる**

例：乾為天（䷀）で初爻が変わると → 天風姤（䷫）

```
乾為天        天風姤
━━━━━       ━━━━━
━━━━━       ━━━━━
━━━━━       ━━━━━
━━━━━  →    ━━━━━
━━━━━       ━━━━━
━━━━━       ━ ━ ━  ← 初爻が陰に変化
```

### 3.2 爻変テーブル（乾為天の例）

| 変爻位置 | 変化後の卦 | 意味 |
|---------|----------|-----|
| 初爻変 | 天風姤 | 始まりで妥協/誘惑に遭う |
| 二爻変 | 天火同人 | 仲間と協力して進む |
| 三爻変 | 天沢履 | 慎重に礼を踏んで進む |
| 四爻変 | 風天小畜 | 小さな蓄積で待つ |
| 五爻変 | 火天大有 | 大いに所有し繁栄 |
| 上爻変 | 沢天夬 | 決断の時、断行せよ |

### 3.3 遷移ルールの定式化

```
next_hexagram = change_line(current_hexagram, changing_yao_position)

例：
- current: 乾為天 (1)
- changing_yao: 5
- next: 火天大有 (14)
```

---

## 4. 予測フレームワーク

### 4.1 状態-行動-結果の予測マトリクス

```
IF 現在の卦 = X
AND 現在の爻位 = Y
AND 取る行動 = Z
THEN 予測される結果 = ?
```

### 4.2 爻位別の推奨行動

| 爻位 | 基本姿勢 | 推奨行動 | 避けるべき行動 |
|-----|---------|---------|--------------|
| 初爻 | 待機 | 学習・準備・観察 | 拙速な行動・表に出る |
| 二爻 | 着実 | 実務・基盤強化・協力 | 冒険・孤立 |
| 三爻 | 慎重 | 熟考・相談・柔軟性 | 強行・固執 |
| 四爻 | 謙虚 | 上位者との調整・準備 | 独断・越権 |
| 五爻 | 決断 | リーダーシップ・実行 | 優柔不断・委任しすぎ |
| 上爻 | 撤退 | 引き際・後進育成 | 執着・強行突破 |

### 4.3 結果予測ロジック

```python
def predict_outcome(hexagram, yao_position, action_type):
    """
    卦・爻位・行動から結果を予測
    """
    # 爻位と行動の適合性を判定
    if yao_position == 1 and action_type == "攻める・挑戦":
        return "Failure", "まだ早い。準備不足で失敗する可能性が高い"

    if yao_position == 5 and action_type == "攻める・挑戦":
        return "Success", "最適なタイミング。リーダーシップを発揮すべき"

    if yao_position == 6 and action_type == "攻める・挑戦":
        return "Failure", "行き過ぎ。後悔する結果になりやすい"

    if yao_position == 3 and action_type == "逃げる・放置":
        return "Mixed", "分岐点での放置は危険。決断が必要"

    # ... 以下、全組み合わせを定義
```

---

## 5. スキーマ拡張

### 5.1 追加フィールド

```json
{
  // 既存フィールド
  "transition_id": "...",
  "target_name": "...",
  // ...

  // 新規追加: 爻レベル情報
  "before_hexagram_id": 1,           // 64卦の番号（1-64）
  "before_yao_position": 5,          // 現在の爻位（1-6）
  "before_yao_quality": "正位",       // 正位/不正位
  "before_yao_phrase": "飛龍在天",    // 該当する爻辞

  "action_changing_yao": [5],        // 変化する爻（複数可）
  "action_hexagram_id": 14,          // 行動後の卦番号

  "after_hexagram_id": 14,           // 最終的な卦番号
  "after_yao_position": 2,           // 到達した爻位

  // 予測との比較
  "predicted_outcome": "Success",    // ロジックによる予測
  "actual_outcome": "Success",       // 実際の結果
  "prediction_match": true,          // 予測と実際が一致したか

  // 分岐シナリオ
  "alternative_actions": [
    {
      "action_type": "守る・維持",
      "predicted_outcome": "Failure",
      "reasoning": "五爻での停滞は機会損失につながる"
    }
  ]
}
```

### 5.2 爻位判定の根拠フィールド

```json
{
  "yao_diagnosis": {
    "market_position": "leader",      // リーダー/チャレンジャー/etc
    "lifecycle_stage": "mature",      // 成長/成熟/衰退
    "financial_health": "strong",     // 強い/普通/弱い
    "external_pressure": "high",      // 高い/中/低い
    "diagnosis_reasoning": "業界首位だが成熟市場で圧力が高い状態"
  }
}
```

---

## 6. 実装ステップ

### Step 1: 64卦×6爻の基本データ整備
- 384の爻辞データを爻位判定ルールと紐付け
- 各爻の「推奨行動」「避けるべき行動」を定義

### Step 2: 爻変遷移テーブル作成
- 64卦×6爻 = 384通りの変化先を計算
- 各遷移の意味を記述

### Step 3: 既存ケースへの爻情報付与
- 8449件のケースに爻位を診断して付与
- 予測結果と実際の結果を比較

### Step 4: 予測精度の検証
- 予測と実際の一致率を計算
- ルールの調整・改善

---

## 7. 期待される効果

### Before（現状）
```
「山一證券は乾→坎だから失敗した」
→ 事後説明のみ。同じ「乾」でも成功ケースもある。
```

### After（爻レベル導入後）
```
「山一證券は乾の上爻（亢龍有悔）にいた。
 上爻での『逃げる・放置』は最悪の選択。
 正しくは『撤退・縮小』を選ぶべきだった。
 もし五爻の段階で問題を認識していれば、
 『刷新・破壊』を選んで生き残れた可能性がある」
→ 具体的な分岐点と選択肢を提示できる
```

---

## 付録: 乾為天の6爻完全解説（サンプル）

| 爻 | 爻辞 | 現代解釈 | 推奨行動 | 成功例 | 失敗例 |
|----|-----|---------|---------|-------|-------|
| 初九 | 潜龍勿用 | 力を蓄える時期。表に出るな | 学習・準備 | - | ソフトバンク初期の孫正義（潜伏期間を設けた） |
| 九二 | 見龍在田 | 実力が認められ始めた | 協力者を得る | 楽天の三木谷（見える形で成果を出した） | - |
| 九三 | 終日乾乾 | 日々警戒を怠るな | 慎重に進む | - | 急成長企業のガバナンス崩壊 |
| 九四 | 或躍在淵 | 飛躍か深淵か | 慎重に機を見る | - | タイミングを誤った大型M&A |
| 九五 | 飛龍在天 | リーダーとして全力を出せ | 決断・実行 | トヨタの豊田章男（攻めの経営） | - |
| 上九 | 亢龍有悔 | 進みすぎて孤立 | 引く・譲る | - | 山一證券、そごう（撤退できず崩壊） |
