# Claude (Anthropic) の見解

## 改善計画v9（Codex設計案採用版）

### 根本転換
「真の卦を当てる」から「注釈者分布（soft label）を予測する」へ問題を再定義。

### 核心設計

**1. 6爻分解アーキテクチャ**
64クラス直当てを廃止し、6本の二値モデルで分解:
- p_j(x) = P(爻j=陽|x) for j=1..6
- p(y|x) ∝ Π p_j^bit_j · (1-p_j)^(1-bit_j) · prior(y)
- 利点: 希少卦でも各爻は十分な出現頻度、未出現卦も確率ゼロにならない

**2. 目的関数**
- コスト行列: C(y,ŷ) = ハミング距離/6
- 期待コスト最小化: L_auto(x) = min_ŷ Σ p(y|x)C(y,ŷ)
- 行動決定: auto iff L_auto ≤ c_u

**3. リーク遮断（K-foldクロスフィット）**
- Test 60件: ロック（最終評価のみ）
- Train+Val 240件: 5-fold cross-fit
  - 各Fold: Train 192件 → Val 48件 → OOF予測
- OOF全体240件で: 統合学習、校正、閾値c_u決定、β決定
- 最終モデル: 240件全体で再学習

**4. soft label集約**
- w(r) = exp(β(r-3)) で評点→重みに変換
- βはクロスフィット内で最適化（恣意的固定値は禁止）

**5. 出力形式**
- 分布出力 + 拒否（ask）を標準
- 単一確定（auto）は高信頼域のみ

### 評価指標（目標値なし、データから決定）
- NLL, Brier Score, KL Divergence（分布品質）
- Auto率、Auto時精度、Ask時Top-5再現率（意思決定品質）

### 工数: 240h
- Phase 1 設計: 32h
- Phase 2 パイロット: 60h
- Phase 3 ゴールドセット: 100h
- Phase 4 モデル構築: 48h

### フォールバック
- 6爻精度低い → 上卦/下卦（8×8）分解に変更
- Auto率<30% → c_uを下げる
- Ask時Top-5再現率<70% → Top-10に拡大