# LLM Debate: 5軸確率分布から64卦384爻へのマッチングロジック

## 議題
5軸確率分布から64卦384爻へのマッチングロジック

## Claude (Anthropic) の見解
マッチング方針: (1)64卦それぞれに5軸の「理想分布」を事前定義（例: 乾為天={拡大:0.7,転換:0.2,維持:0.1,収縮:0}, agency={自ら動く:0.8,...}）(2)ユーザー回答の分布と各卦の理想分布のコサイン類似度を計算 (3)Top-5卦を候補として提示 (4)爻の選択は、卦決定後にtimeframe/agency/emotionalToneの組み合わせで6段階にマッピング（初爻=まだ動くな〜上爻=完成期）(5)マッチスコア=Σ(軸ごとの類似度×軸の重み)、重みは均等から開始し運用データで調整。懸念: 64卦×5軸の理想分布をどう決めるか（易経の解釈に依存）、爻のマッピングが恣意的になるリスク。

## Codex (OpenAI GPT-5.2) の批評
### 結論（最初に明言）
Claude案（卦ごとの理想分布＋コサイン類似度＋卦決定後に爻を一般マッピング）は設計として破綻している。なぜなら「理想分布」の根拠が検証不能で、確率分布比較として不適切な指標を使い、さらに爻を卦から独立に選ぶ二段階設計が易経側の意味構造と説明可能性を同時に壊すからである。要件が「384への決め打ち」なら、この方式の採用は誤りである。

---

### 批判的分析

#### 1. 論理的整合性
- **5軸→384の識別は情報量が不足である。** timeframeは6択1問、relationshipは多選1問で解像度が低く、残りも比率に圧縮される。異なる多数の（卦×爻）が同一の5軸分布を取り得るため、安定な順位付けは成立しない。
- **「理想分布」を卦に付与する前提が未定義である。** 乾為天={拡大0.7…}のような割当は、採点者の解釈に依存する。解釈規約（ルーブリック）なしに数値だけ置くと、体系は内的整合性を持たない。
- **二段階（卦→爻）の独立選択は誤りである。** 爻の意味は卦に条件付く。卦と無関係に「timeframe/agency/emotionで初爻〜上爻」を決めると、同じ爻段階でも卦ごとの文脈差を吸収できず、説明文が必ず矛盾する。
- **軸の二重使用で重み付けが崩壊する。** 卦決定にtimeframe/agency/emotionを使い、さらに爻決定でも同じ軸を使うと、その3軸が実質的に過重になる。これは設計原理ではなく偶然のバイアスである。

#### 2. 実現可能性
- **実装は容易だが品質保証は不可能である。** 類似度計算自体は数百行で終わる。一方、64卦（または384爻）に5軸の分布を与える作業は「本体」であり、ここが最大コストである。ここを雑に作ると出力がランダム占いになる。
- **「運用データで重み調整」は目的関数が不正である。** KPIが自己納得度中心だと、最適化はユーザー迎合（バーナム効果）へ収束する。これは予測でも診断でもなく、満足度最大化の作文生成器になる。

#### 3. 新規性の真偽
- **新規性はない。** 「プロトタイプ（理想分布）に対する距離で最近傍分類」は既存手法そのものである。易経ドメインを載せ替えただけで、方法論として新しくない。

#### 4. スケーラビリティ
- **保守が崩壊する。** 軸を1つ増やす、選択肢を変える、設問の意味を調整するたびに、全卦（全爻）の理想分布を再定義する必要が生じる。これは運用で耐えない。
- **版管理の必須化を招く。** v4→v5で分布定義が変わると、同一ユーザーの再テスト比較が無意味になる。診断としての連続性が壊れる。

#### 5. 反例・エッジケース
- **「わからない」が高確信度になる破綻。** timeframeをone-hotで扱うと「わからない」はエントロピー0でconfidence=1になる。情報が無い選択が最も確信度が高いという矛盾が発生する。
- **混合状態を“不確か”と誤判定する破綻。** 感情や変化性質が混ざるのは現実の状態であり、エントロピーが高い=測定が不確かではない。これをconfidence低として追加質問で単一感情へ強制すると、v4の「混合状態保持」原則と正面衝突する。
- **同点・近接が多発しTop-5が恣意化する。** 軸数と解像度が低く、距離が同点になりやすい。タイブレーク規則を入れた瞬間に「数学」ではなく「作者の好み」になる。

#### 6. 代替案との比較
- **より優れた設計は存在する。** 少なくとも「確率分布同士の距離」「卦と爻の条件付きモデル」「欠損（わからない）の扱い」を備えた方式は、Claude案より一貫性・検証性・説明可能性が高い。

---

### Claudeの意見への反論/修正
- **正しい部分**: 「卦ごとに参照プロファイルを用意して上位候補を出す」という枠組みは、実装容易性と説明可能性（寄与度分解）に利点がある。懸念として挙げた「理想分布の決め方」「爻マッピングの恣意性」も核心を突いている。
- **誤り（致命傷）**:
  - **コサイン類似度採用は誤りである。** 確率分布比較としての幾何が不適切で、スコアの意味が崩れる。特に「%表示」や「差分12pt」の解釈が成立しない。
  - **爻を卦から独立に決める設計は誤りである。** 易経側の意味論に反し、説明文が整合しない。
  - **重みを運用データで調整する方針は甘い。** 何を正解とみなして最適化するかが欠落している。自己納得度で最適化すると「当たった感」を最大化するだけで、モデル妥当性が消える。

---

### より正確な見解
1) **要件を正す**  
「5軸から384を一意に決める」は誤りである。正しい要件は「384の事後確率（ランキング）を出す」「不確実さを表示する」である。決め打ちは捨てるべきである。

2) **スコアリングを“分布に適した”形に替える**  
- 各（卦×爻）をクラス \(k\) とし、各軸の参照分布 \(q_{k,a}\) を持たせる。  
- ユーザー分布 \(p_a\) との距離は **Jensen–Shannon距離** や **交差エントロピー** のような分布向け指標を使う。  
- 総合スコアは \(Score(k)=\sum_a r_a \cdot f(p_a,q_{k,a})\) とし、\(r_a\) は「測定の信頼性」である。エントロピー（混合度）を \(r_a\) に流用するのは誤りである。

3) **爻は“卦に条件付けて”決める**  
- 二段階にするなら \(P(爻 \mid 卦, 入力)\) を卦ごとに持つ。一般マッピングは禁止である。  
- 実務的には「384を直接ランキング」する方が一貫する（卦→爻の独立性問題を消す）。

4) **欠損の扱いを明確化する**  
- timeframeの「わからない」はカテゴリではなく欠損として扱い、その軸の重み \(r_{timeframe}=0\) に落とす。これをやらない限り、論理は必ず破綻する。

5) **理想分布の作り方を“検証可能な作業”に落とす**  
- ルーブリック（各軸・各カテゴリに対応する易経記述の根拠規則）を先に作り、LLM生成＋専門家レビューで \(q_{k,a}\) を作る。数値の「雰囲気置き」は禁止である。  
- その上で、Top-5提示と寄与度説明は成立する。

以上が「本質を外さず、実装でき、説明が崩れない」設計である。


## 統合分析

### 共通点
1. **参照プロファイル方式自体は有効** - 各卦にプロファイルを持たせてマッチングする枠組み
2. **Top-k候補の提示** - 一意決定ではなく複数候補を出す方向性
3. **懸念点の認識** - 「理想分布の決め方」「爻マッピングの恣意性」は核心問題

### 相違点（致命的な設計ミス）

| 項目 | Claude案 | Codex批評 |
|------|----------|-----------|
| **類似度指標** | コサイン類似度 | 確率分布に不適切。Jensen-Shannon距離/交差エントロピーを使え |
| **卦→爻の決定** | 二段階独立（一般マッピング） | 爻は卦に条件付き。独立は易経の意味構造を壊す |
| **「わからない」処理** | カテゴリとして扱う | 欠損として扱い、その軸の重み=0 |
| **混合状態の解釈** | エントロピー高=確信度低 | 混合は「現実の状態」であり「測定の不確かさ」ではない |
| **理想分布の作成** | 雰囲気で数値設定 | ルーブリック作成→LLM生成→専門家レビュー |

### Codex批評の核心的指摘

**Claude案は設計として破綻している。**

1. **情報量不足**: 5軸の解像度では384クラスの安定順位付けは不可能
2. **コサイン類似度は誤り**: 確率分布比較の幾何として不適切
3. **二段階独立は誤り**: 爻の意味は卦に依存するため、一般マッピングは説明文を矛盾させる
4. **「わからない」の破綻**: one-hot→エントロピー0→confidence=1（情報なしが最高確信の矛盾）
5. **混合≠不確か**: 混合状態を低確信として追加質問で単一化するのは「混合状態保持」原則と矛盾

### 結論・推奨

**マッチングロジックv5として再設計が必要**

#### 修正すべき点

1. **384を直接ランキング**（卦→爻の二段階をやめる）
   ```
   全384クラスに対してスコア計算 → Top-5提示
   ```
   - 二段階の独立性問題を根本解消
   - 爻の意味が卦に条件付く構造を保持

2. **類似度指標をJensen-Shannon距離に変更**
   ```typescript
   function jsDistance(p: number[], q: number[]): number {
     const m = p.map((pi, i) => (pi + q[i]) / 2);
     return Math.sqrt((klDiv(p, m) + klDiv(q, m)) / 2);
   }
   ```

3. **「わからない」は欠損扱い**
   ```typescript
   if (timeframe === "わからない") {
     weights.timeframe = 0;  // この軸をスコア計算から除外
   }
   ```

4. **混合状態の扱いを修正**
   - エントロピー高 ≠ 確信度低
   - 「混合度」と「測定の不確かさ」を分離
   - 混合状態のまま説明文を生成（「拡大と維持が同程度」など）

5. **理想分布の作成プロセスを明確化**
   ```
   Step 1: ルーブリック作成（各軸→易経記述の対応規則）
   Step 2: LLMで384クラスの参照分布を生成
   Step 3: 易経専門家レビュー
   Step 4: パイロットテストで分布調整
   ```

6. **重み調整の目的関数を明確化**
   - 自己納得度で最適化 → バーナム効果への収束（×）
   - 妥当な目的関数: 「説明文と事例DBのマッチ度」「専門家評価」

---

## v5設計の骨格（次のディベート用）

```typescript
interface MatchingResult {
  ranking: Array<{
    classId: number;        // 1-384 (hexagram * 6 + yao)
    hexagram: number;       // 1-64
    yao: number;            // 1-6
    score: number;          // JS距離ベース（0=完全一致、1=最大乖離）
    confidence: number;     // 測定の信頼性（欠損軸があると低下）
    mixedState: boolean;    // 混合状態フラグ
    contributions: {        // 寄与度分解
      [axis: string]: number;
    };
  }>;
  missingAxes: string[];   // 欠損扱いにした軸
}

// 384クラスの参照分布
interface ClassProfile {
  classId: number;
  hexagram: number;
  yao: number;
  distributions: {
    changeNature: { 拡大: number, 収縮: number, 維持: number, 転換: number };
    agency: { 自ら動く: number, 受け止める: number, 待つ: number };
    timeframe: { 即時: number, 短期: number, 中期: number, 長期: number };
    relationship: { 個人: number, 組織内: number, 対外: number };
    emotionalTone: { 前向き: number, 慎重: number, 不安: number, 楽観: number };
  };
  rubricSource: string;    // この分布の根拠（易経のどの記述から）
}
```

---

## 次のアクション

1. **ルーブリック設計** - 5軸と易経記述の対応規則を定義
2. **384クラスの参照分布生成** - LLM + 既存事例DBを活用
3. **JS距離ベースのマッチング実装**
4. **「混合状態」の説明文テンプレート設計**

---
*生成日時: 2026-01-13T14:20:35.615Z*
*統合分析完了: 2026-01-13*
