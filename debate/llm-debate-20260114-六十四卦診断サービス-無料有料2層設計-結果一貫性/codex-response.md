# Codex (OpenAI GPT-5.2) の批評

### 結論（最初に明言）
Claude案は「無料/有料で結果が違うと不信感が出る」という課題を表面上なぞっているだけで、**結果一貫性を保証できない欠陥設計である**。一貫性の本質は「同一鑑定IDに対して同一のコア結果を固定し、無料はその抜粋・有料は展開を表示する」ことであり、**入力ハッシュ＋LLM算出に依存する設計は誤りである**。

### 批判的分析
#### 1. 論理的整合性
- 「結果は同じ、深さが違う」と言いながら、**“結果”の定義が曖昧**である。易の“結果”は本卦だけでは終わらない（変爻・之卦・用神など、設計次第でコア要素が増える）。無料で本卦しか確定していないのに、有料で変爻判定を後付けすると、同一結果の主張は破綻する。
- **LLMで64卦算出**は論理矛盾である。卦の算出は決定論の写像であり、確率生成器に委ねた時点で「同じ入力→同じ卦」を仕様として保証できない。

#### 2. 実現可能性（隠れたコスト含む）
- 入力ハッシュキャッシュは「同一テキスト完全一致」しか守らない。改行・空白・表記ゆれ・追記で別ハッシュになり、ユーザー体験として「無料と有料で違う」に直結する。
- キャッシュは**運用設計が本体**である。バージョニング（プロンプト/モデル/DB改訂）、保存期間、個人情報の扱い、削除要求対応、監査ログが必ず必要になる。LLM単価だけ見たコスト議論は誤りである。
- 「キャッシュヒットならAPIコスト0」は論点ずらしである。自然言語入力の再送は低頻度で、コストの大半は新規入力で発生する。さらにストレージ・検索・監視・不正対策コストはゼロにならない。

#### 3. 新規性の真偽
- 「無料は薄く、有料は深く」「安価モデルで入口、上位モデルで展開」「キャッシュで節約」は既存の定番設計であり、新規性はない。差分は実装の丁寧さだけで決まる。

#### 4. スケーラビリティ
- 入力ハッシュキャッシュはスケールすると**保存データが無限増殖**し、削除（TTL/上限）を入れた瞬間に「同じ入力で同じ結果」が崩れる。
- 不正利用（自動連打・微小変更）に対してキャッシュは無力である。レート制限・認証・課金導線・Bot対策が必須で、ここが実務コストの中心になる。

#### 5. 反例・エッジケース（破綻パターン）
- 無料：卦名＋キーワードが「吉」寄り、有料：爻辞解釈が「戒め」寄りになると、ユーザーは結果が違うと判断する。**深さの差ではなく意味の矛盾**として受け取られる。
- 無料→有料の導線で、ユーザーが質問を追記して購入するとハッシュが変わり別鑑定になる。説明なしにこれを起こすと不信感が確定する。
- モデル更新・プロンプト更新・DB改訂で、有料詳細の文言が変わる。**過去購入分まで変動**すると、品質より先に信用が失われる。

#### 6. 代替案との比較
- 最良手は「算出＝決定論」「表示＝段階的開示」「生成文＝同一鑑定IDに紐付けて固定」である。Claude案はこの基本を満たしていない。

### Claudeの意見への反論/修正
- **誤り1：卦算出をLLMに任せる発想**が根本的に悪い。算出はアルゴリズムでゼロコスト・ゼロ揺れで実装できる領域であり、ここにLLMを入れるのは品質と信用を自ら捨てている。
- **誤り2：入力ハッシュを一貫性の土台に置く**のが浅い。一貫性は「入力文字列」ではなく「鑑定オブジェクト（本卦/変爻/之卦/バージョン）」に紐付けるべきである。
- **誤り3：無料と有料で別生成**（無料：卦名＋キーワード、有料：詳細）を前提にしている点が甘い。別生成は矛盾を防ぐ保証が存在しない。
- **正しい点**は「無料/有料でコア結果を揃え、出力の深さで差別化する」というプロダクト原則そのものだけである。実装の置き方が間違っている。

### より正確な見解
- **結果一貫性の正解は“鑑定ID固定”である。**最初のリクエストで「本卦・変爻・之卦（必要なコア一式）・算出法・バージョン」を確定し、`reading_id`として保存する。無料も有料も必ずこの`reading_id`を参照する。
- **無料は“有料の抜粋”として設計する。**無料文言を別生成せず、同一鑑定オブジェクトから機械的に切り出す（固定テンプレ or 有料本文の先頭固定プレビュー）。これで矛盾は構造的に消える。
- **LLMは算出に使わず、言語化に限定する。**易経DB（卦辞・爻辞・解釈テーブル）を一次情報にし、LLMは「状況への当てはめ」と「文章整形」のみに使う。生成結果は`reading_id`に保存し、後から変わらないように固定する。
- **バージョニングを仕様に入れる。**DB改訂や解釈方針変更は`interpretation_version`として分離し、過去購入分は当時のバージョンで再表示する。再解釈を出すなら別IDとして扱う。

この設計に直すと、無料/有料の差別化を維持したまま「結果が違う」問題を根から断ち切れる。
